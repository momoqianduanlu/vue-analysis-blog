<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js源码构建 | vue源码解析</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="vue源码解析课程笔记 记录细节实现">
    <link rel="preload" href="/vue-analysis-blog/assets/css/0.styles.d07f82ba.css" as="style"><link rel="preload" href="/vue-analysis-blog/assets/js/app.6aeeb6df.js" as="script"><link rel="preload" href="/vue-analysis-blog/assets/js/2.8ac59259.js" as="script"><link rel="preload" href="/vue-analysis-blog/assets/js/5.b31e05fb.js" as="script"><link rel="prefetch" href="/vue-analysis-blog/assets/js/10.20c9d7ce.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/11.e3ae312d.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/12.1e156bc6.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/13.131b32cb.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/14.f37a321f.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/15.01f4e820.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/16.bd0bfdcc.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/17.88bb3a26.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/18.92cd0497.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/19.e9845e4f.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/20.37c7e4d8.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/21.90eb88f7.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/22.676923d8.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/23.7db1f24c.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/24.1079b0d8.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/25.471c5dd4.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/26.d6a7543a.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/27.95265ee3.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/28.4d0ddea1.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/29.27c3d4e7.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/3.c2ba8fa6.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/30.e2e6df6c.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/31.81c0c28c.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/32.05c48121.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/33.464f3ea6.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/34.92b778a7.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/35.707ced33.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/36.67796c42.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/37.ad4edb1b.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/38.77ea592b.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/39.6a1b09ea.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/4.5390220c.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/40.476918aa.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/41.80c8bf8b.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/42.7cf6be04.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/43.7f59e355.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/44.83fd3377.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/45.13754e7e.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/46.17963f12.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/47.4581e28b.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/6.3c8b0c72.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/7.3ba56037.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/8.56405d2d.js"><link rel="prefetch" href="/vue-analysis-blog/assets/js/9.56a1ac1f.js">
    <link rel="stylesheet" href="/vue-analysis-blog/assets/css/0.styles.d07f82ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-analysis-blog/" class="home-link router-link-active"><!----> <span class="site-name">vue源码解析</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter1/" aria-current="page" class="sidebar-link">Vue 源码目录设计</a></li><li><a href="/vue-analysis-blog/chapter1/Vue.js 源码构建.html" class="active sidebar-link">Vue.js源码构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-analysis-blog/chapter1/Vue.js 源码构建.html#vue的构建脚本" class="sidebar-link">vue的构建脚本</a></li><li class="sidebar-sub-header"><a href="/vue-analysis-blog/chapter1/Vue.js 源码构建.html#vue的构建过程" class="sidebar-link">vue的构建过程</a></li><li class="sidebar-sub-header"><a href="/vue-analysis-blog/chapter1/Vue.js 源码构建.html#runtime-only-vs-runtime-compiler" class="sidebar-link">Runtime Only VS Runtime + Compiler</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>从入口到Vue的构造函数</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter2/" class="sidebar-link">从入口开始</a></li><li><a href="/vue-analysis-blog/chapter2/initGlobalApi.html" class="sidebar-link">initGlobalApi</a></li><li><a href="/vue-analysis-blog/chapter2/initMixin.html" class="sidebar-link">initMixin</a></li><li><a href="/vue-analysis-blog/chapter2/stateMixin.html" class="sidebar-link">stateMixin</a></li><li><a href="/vue-analysis-blog/chapter2/eventsMixin.html" class="sidebar-link">eventsMixin</a></li><li><a href="/vue-analysis-blog/chapter2/lifeCycleMixin.html" class="sidebar-link">lifeCycleMixin</a></li><li><a href="/vue-analysis-blog/chapter2/renderMixin.html" class="sidebar-link">renderMixin</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据驱动</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter3/" class="sidebar-link">数据驱动</a></li><li><a href="/vue-analysis-blog/chapter3/new Vue 发生了什么.html" class="sidebar-link">new Vue 发生了什么(initState)</a></li><li><a href="/vue-analysis-blog/chapter3/$mount.html" class="sidebar-link">Vue 实例挂载的实现($mount)</a></li><li><a href="/vue-analysis-blog/chapter3/render.html" class="sidebar-link">render和renderProxy</a></li><li><a href="/vue-analysis-blog/chapter3/createElement.html" class="sidebar-link">createElement</a></li><li><a href="/vue-analysis-blog/chapter3/update.html" class="sidebar-link">update</a></li><li><a href="/vue-analysis-blog/chapter3/第二章总结.html" class="sidebar-link">Vue是如何将数据渲染到dom的</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter4/" class="sidebar-link">组件化</a></li><li><a href="/vue-analysis-blog/chapter4/createComponent.html" class="sidebar-link">createComponent</a></li><li><a href="/vue-analysis-blog/chapter4/patch.html" class="sidebar-link">patch</a></li><li><a href="/vue-analysis-blog/chapter4/组件生成vnode到patch.html" class="sidebar-link">组件生成的vnode如何patch成真实dom</a></li><li><a href="/vue-analysis-blog/chapter4/合并配置.html" class="sidebar-link">合并配置</a></li><li><a href="/vue-analysis-blog/chapter4/生命周期.html" class="sidebar-link">生命周期</a></li><li><a href="/vue-analysis-blog/chapter4/组件注册.html" class="sidebar-link">组件注册</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>虚拟DOM和VNode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter5/" class="sidebar-link">虚拟DOM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>深入响应式原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter6/" class="sidebar-link">响应式对象</a></li><li><a href="/vue-analysis-blog/chapter6/依赖收集.html" class="sidebar-link">依赖收集</a></li><li><a href="/vue-analysis-blog/chapter6/派发更新.html" class="sidebar-link">派发更新</a></li><li><a href="/vue-analysis-blog/chapter6/nextTick.html" class="sidebar-link">nextTick</a></li><li><a href="/vue-analysis-blog/chapter6/变化侦测注意事项.html" class="sidebar-link">变化侦测注意事项</a></li><li><a href="/vue-analysis-blog/chapter6/变化侦测API实现.html" class="sidebar-link">变化侦测API实现</a></li><li><a href="/vue-analysis-blog/chapter6/computed处理.html" class="sidebar-link">computed处理</a></li><li><a href="/vue-analysis-blog/chapter6/watch处理.html" class="sidebar-link">Watch处理</a></li><li><a href="/vue-analysis-blog/chapter6/props处理.html" class="sidebar-link">props处理</a></li><li><a href="/vue-analysis-blog/chapter6/method处理.html" class="sidebar-link">method处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编译原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter7/" class="sidebar-link">介绍</a></li><li><a href="/vue-analysis-blog/chapter7/compileToFunctions.html" class="sidebar-link">compolieToFunctions</a></li><li><a href="/vue-analysis-blog/chapter7/parse模板解析.html" class="sidebar-link">parse模板解析</a></li><li><a href="/vue-analysis-blog/chapter7/optimize优化.html" class="sidebar-link">optimize优化</a></li><li><a href="/vue-analysis-blog/chapter7/codegen代码生成.html" class="sidebar-link">codegen代码生成</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-analysis-blog/chapter8/" class="sidebar-link">扩展</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-js源码构建"><a href="#vue-js源码构建" class="header-anchor">#</a> Vue.js源码构建</h1> <p>Vue.js 源码是基于 <a href="https://github.com/rollup/rollup" target="_blank" rel="noopener noreferrer">Rollup<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 构建的，它的构建相关配置都在 <code>scripts</code>目录下。</p> <p>使用<code>rollup</code>进行构建是因为<code>rollup</code>更适合 js 代码的打包，他也只会去打包 js 代码，其他不相关的资源他都不会去管的，而 <code>webpack</code> 打包代码他是 <code>js</code> <code>css</code> 以及图片资源都会进行打包，这样比较来看 <code>rollup</code> 更适合一些 <code>库</code> 的编译打包，而且使用起来比 <code>webpack</code> 更轻量，打包出来的代码更友好。</p> <h2 id="vue的构建脚本"><a href="#vue的构建脚本" class="header-anchor">#</a> vue的构建脚本</h2> <p>通常一个基于 NPM 托管的项目都会有一个<code>package.json</code> 文件，这个文件是对项目的描述文件，它的内容实际上是一个标准的 JSON 对象。</p> <p>我们通常会配置 <code>script</code> 字段作为 NPM 的执行脚本，Vue.js 源码构建的脚本如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/build.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build:ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build -- web-runtime-cjs,web-server-renderer&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build:weex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build -- weex&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
</code></pre></div><ul><li>buid: 构建出 web 平台的 vue.js</li> <li>build:ssr: 构建出服务端渲染的 vue.js</li> <li>build:weex: 构建出 weex 的 vue.js</li></ul> <p>这里总共有 3 条命令，作用都是构建 Vue.js，后面 2 条是在第一条命令的基础上，添加一些环境参数。</p> <p>当在命令行运行 <code>npm run build</code> 的时候，实际上就会执行 <code>node scripts/build.js</code>，接下来我们来看看它实际是怎么构建的。</p> <p>前面我们分析 vue 的源码是在 <code>src</code> 目录下，那我们执行 <code>build</code>命令后它的源码是打包在了 <code>dist</code> 目录下</p> <p><img src="data:image/png;base64,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" alt="dist"></p> <p>我们看到在 dist 目录下已经构建出了很多版本的 vue.js。</p> <p>那么为什么我们能构建出如此多版本的vue.js呢？</p> <h2 id="vue的构建过程"><a href="#vue的构建过程" class="header-anchor">#</a> vue的构建过程</h2> <p>当我们执行 <code>npm run build</code> 的时候，他首先执行的是一个脚本，<code>&quot;build&quot;: &quot;node scripts/build.js&quot;</code> 也就是让我们的 node 运行 <code>scripts</code> 目录下的 <code>build.js</code>文件，当我们去运行这个文件的时候，他就开始去跑这个 js 文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1. 加载一些build所需要的依赖</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rollup <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> terser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. builds 这里就是要拿到我们所有要构建的配置</span>
<span class="token keyword">let</span> builds <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 拿到配置以后我要对这份配置做一层过滤</span>
<span class="token comment">// process.argv 属性返回一个数组</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filters <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> filters<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> b<span class="token punctuation">.</span>_name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// filter out weex builds by default</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'weex'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 4. 最终我们要调用 build函数</span>
<span class="token function">build</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">build</span> <span class="token punctuation">(</span><span class="token parameter">builds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> built <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> builds<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">buildEntry</span><span class="token punctuation">(</span>builds<span class="token punctuation">[</span>built<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      built<span class="token operator">++</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>built <span class="token operator">&lt;</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>logError<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>module.exports 初始值为一个空对象 {}，所以 exports 初始值也是 {}</p> <p>exports 是指向的 module.exports 的引用</p> <p>require() 返回的是 module.exports 而不是 exports</p> <p>map() 方法返回一个新数组，新数组中的元素为原始数组中的每个元素调用函数处理后得到的值。</p></blockquote> <ol><li>首先我们来分析配置是怎么拿到的</li></ol> <p>我们先打开配置文件 <code>config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在这个配置文件的最后我们也向外暴露了一个方法，</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">genConfig</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  exports<span class="token punctuation">.</span>getBuild <span class="token operator">=</span> genConfig
  exports<span class="token punctuation">.</span><span class="token function-variable function">getAllBuilds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>genConfig<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>
  <span class="token comment">// getAllBuilds 是一个函数，他会拿到 builds 所有的 key 进行循环，然后再调用 genConfig 函数，</span>
	exports<span class="token punctuation">.</span><span class="token function-variable function">getAllBuilds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>genConfig<span class="token punctuation">)</span>
<span class="token punctuation">]</span>

</code></pre></div><ol start="2"><li>下面来看这个 builds 是什么东西</li></ol> <p><code>builds</code>是一个对象，对象的每一个 <code>key</code> 的值也是一个对象，我们单独来分析一下其中的某一个对象，通过注释我们可以看到它应该是不同版本的 vue.js 的配置，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> builds <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Runtime only (CommonJS). Used by bundlers e.g. Webpack &amp; Browserify</span>
  <span class="token string">'web-runtime-cjs-dev'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'web/entry-runtime.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 入口</span>
    dest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/vue.runtime.common.dev.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 目标</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    banner
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>resolve函数解析  <code>entry: resolve('web/entry-runtime.js')</code></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> aliases <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./alias'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> base <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>aliases<span class="token punctuation">[</span>base<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>aliases<span class="token punctuation">[</span>base<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>resolve</code>  函数我们在前面定义了，这个函数的功能是接受一个参数 <code>p</code>，然后这个 p 会进行一个 <code>split</code>，以 <code>/</code> 分割，拿到第一个值以后，也就是 <code>web/entry-runtime.js</code> =&gt; <code>web</code>，此时 <code>base =&gt; web</code>，然后他又进行了一个 <code>aliases</code>，</p> <ol start="4"><li>我们下面去分析 <code>alias.js</code> 文件</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">p</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  vue<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/web/entry-runtime-with-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  compiler<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  core<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/core'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  shared<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/shared'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  web<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/web'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weex<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/platforms/weex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  server<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/server'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entries<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/entries'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  sfc<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/sfc'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个 <code>alias.js</code> 最后导出的也是一个对象，对象的每一个 <code>key</code> 通过 <code>resolve</code> 函数返回的也是一个字符串，那么我们现在可以单独拿一个字符串来看看这个字符串到底对应的是什么？</p> <p>看起来这个字符串对应的应该是一个文件地址，<code>src/platforms/web/entry-runtime-with-compiler</code>，通过 <code>resolve()</code>函数对这个字符串进行处理以后我们可以看到他最终指向的就是 <code>src/platforms/web/entry-runtime-with-compiler</code>这个文件，这个 <code>alias</code> 最终提供的就是一个到最终文件地址的映射关系，然后我们可以通过更简单的 key 的方式可以获取。</p> <p>对<code>alias.js</code>文件分析完成后，我们知道我们最终通过 alias.js 得到的是一个文件地址，那么现在我们回到当前的代码，我们知道现在的 base 是 web，那么 <code>if (aliases[base])</code> =&gt; <code>src/platforms/web</code>，</p> <p>那么我们在下面<code>return</code>出去的就是 <code>path.resolve(aliases[base], p.slice(base.length + 1))</code> =&gt;</p> <p><code>src/platforms/web</code>  文件夹中的 <code>p.slice(base.length + 1) =&gt; （entry-runtime.js）</code></p> <p>p.slice(base.length + 1) === 从<code>web/</code>往后面开始截取字符串，拿到的就是 <code>entry-runtime.js</code>。</p> <p><strong>所以我们最终得到的结果就是 src/platforms/web/entry-runtime.js</strong>。</p> <ol start="5"><li><code>dest: resolve('dist/vue.runtime.common.dev.js')</code></li></ol> <p><code>dest</code> 同样也是调用这个 <code>resolve</code> 函数，那我们继续去查看 alias.js，但是 alias.js 中是没有配置这个 dist 的 key，所以我们会走<code>config.js</code> 中 <code>resolve</code> 函数的 else，else中最终指向的文件夹是 <code>dist</code>文件夹，</p> <p>所以他最终找到的就是 <code>dist/vue.runtime.common.dev.js</code>。</p> <ol start="6"><li><code>format: 'cjs'</code></li></ol> <p><code>format</code> 是我们构建出来的文件格式，实际上也就是我们之前的 <strong>Commonjs模块</strong> <strong>AMD模块</strong> 以及 <strong>es6导出 esm</strong>，也就是说我们可以通过不同的 <code>format</code> 可以构建出不同的版本，</p> <ol start="7"><li><code>banner</code></li></ol> <p><code>banner</code> 是什么，他其实是一个局部变量，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> banner <span class="token operator">=</span>
  <span class="token string">'/*!\n'</span> <span class="token operator">+</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> * Vue.js v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
  ` <span class="token operator">*</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2014</span><span class="token operator">-</span>$<span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> Evan You\n` <span class="token operator">+</span>
  <span class="token string">' * Released under the MIT License.\n'</span> <span class="token operator">+</span>
  <span class="token string">' */'</span>
</code></pre></div><p>它实际上是定义了一个注释，</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjcAAAB3CAYAAAD/72HrAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABIPSURBVHhe7d1Pi9xGGsfxfS25bMjRa0xgmLUX4g1MnDADITBgBkMGk0DAGDy3zMW+BJ8GQl7C3nMKuQXyxrSqf2qp6qnSI7U03ar5Hj5stqUuqUo99fxcrRn945+fftIcq3+fPgIAAJiEcAMAAKpCuAEAAFUh3AAAgKoQbgAAQFW2GW6ef9H89Paq+f4bYVvr/NVV89N3n4vbOr6Nm1en8nYAALBJmww3X373bXPz4xfNl/3Xv3nRBRWz3QWf0+b7t982l897+wU+3IyGIAAAsCn5cPPql+bPv/9q/v779+a3V8L2eyCdsAssUij5vLn88aq5acPM96+MNuyUVmYINwAAVEkIN181v/3Rhpo/fml+/vX34ws3ZoUmtxpj+ZAz+nVTLiQBAIAtS8LNz//7q/nz16/sf18dXbgpBRd55SYfXgg3AADUqHjPzdGFG/9Vkngjce+eG3ND8eg9N4QbAACqtKlwI95ILFD9thThBgCAKm0o3CwdRgg3AADUaDvhxt5I/KI577+2Fxducn8rBwAAbNNGwo32N6CmINwAAFCjbYSb0o3EAAAAPZsIN+YGYc2NxJPYr7mWXg0CAACHloQbF2jMXyYW/PFLcxXtvyZ3kivd+Eu4AQCgSsWVm0OzJ7n4jcQAAKBmRx5u1riRGAAA1Oz4V24AAAAmINwAAICqEG4AAEBVCDcAAKAqRx1u/vvlf8TXAQAAcgg3AACgKoQbAABQFcINAACoCuEGAABUpcpw8+zyqvnhxWfitio9fe6ek/X6pHksbQcA4AGpJ9yYAn/5yP734xcXzcun5vVHzcu3F83X/4r2rQ3hBgCAjhhuTq5vm7u7jzsfrpoTYb+1TVu5+az5+nVb4Nsw8/LS8AXfBx49E4gKQeFfJ80P7fYHtTI0g1k9s+MfTL4OAj/2XZt7hrnuHIvnFj5XXHMA2Iok3NhgMwgzZ83NgQLOvK+lfDHao5i6oiev+JhVodw2OHb8+uMfQslK12Qyv9L18qkPspnz6q71UwItAGyJ6mspt5Jz21yfytvXssTKzayC5Itf+l5/jG7FwBXHeD9XFJ83z3qvWeHro2BusY9XMEbai1dRZo1JYcVKE/jcOQhjomHHbaFgY/sRzqMQbswxw3Uu9B0AcHzqCTemGPkiZQrpfvfcZL6aSoqcPtykAaBQWCfLr1ZJoeJZG/6mj0kc7KLXR/oxP9zo2p9HeQ0INwCwKapwc/7O3HvzpjkXtq1p3tdSrpDuW4ik1Yg0tGjDjbzfcisSuQCwbDCQxiQUfhcmc3LBSCOM3SPXRvvfQfmYGoQbAKjReLi5eONuKn53Jm9f0dxws4ikoElBQRluciFGFQw08iHGrZgoCrhK2t80yKXcPjPDgR8jOWjuO3aEGwCoUTnchGCzid+WWlq02iAGEV24CYU4Z81wY8TH36dI27DUrcC445ba6449N1xlg0W5zzqEGwCoUT7cnF417+2vgt//11HBYcNNKMxuxSAOLM6eKzeL0RZ6v98+hbrfF1v0C/2y+7bHm/V1VCCPMeEGAJAjh5sjCDbGocPNrqj5+z2SIigV3hAgeuHGtzNlhSZ8naQrqFMK/b6hwL3fnJcNcbngMiXYFPfNnW8u9EwZO8INANQoDTdHEmyMg4ebLqg4aTjx26Ovadz+w1UeV3C1qze+6BqqVY9CAIjfv0ChdqHmedt2JrBNXLHp7gvKjY9vr38s9554Jc2YMnaEGwCoURJu3G9GZdzzvTeHDze9e0bEQmr0imkogLYYp/vv2urJFODFVm58Ye4fc+97fLo2pTEZBsKEdI6aMBT2CQr7lsdueL1i3dgI47az5leMAIB9lW8oPrBjCDfbUAg3AAA8MISbGvC1CQAAHcLNBj1+8XzwtUj+/hMAAB4ews0mxfe1EGwAAAgINwAAoCqEGwAAUBXCDQAAqArhBgAAVIVwAwAAqkK4AQAAVSHcAACAqlQZbswftVv+r/W6ZxLNfi6T/SvCPJMIAIC11RNuzIMV/bOVzAMqXQgxgWSJQOH/aJ7yKdc5/CVhAADWl4abizcHfxp4MG3lJvzV3jbYXBr+KdILPExyuVCyTEiykqdW50NceEp2kF3V6trUBMLd07X3WSWLzy17vZL+5q9H12bh2sfHnf+k9MJTxjfxIFN//rnPpH8aO88tA7AlipWbs+bmQAFn3tdSCz8h2xfV+cUv4tvbq1jYNoYBxBXrOJSEwNcLAmKx2oWuZy8uhHZS/XAwty+2jf51CgEmvnbJOQv96u338qkv2OJnQAiYe12T0rE2IhtgRoIPABwp1ddSJ9e3zd3dm+Zc2LamJVZu5hbewBbg0ck9HDsohwMXDBb+ekoq0LZopedivrbrH9+cT3if2zYSbvyxQojYd4z70rHxY5uEh+jY9pzC+/KBI+57MP+aaMKNEKgC6br510qfJ9sP254/vjf3Wkj9z30W3Ou7Y45eGy839gCwtHrCjSnkfpI1E/Uy99zIk/RAKESDwtUWs8tCIOpWGIRtcwlF0haspKDuiqF0/FxB2+mHDcX4TJQUWd+v+Fy7AisGT99HIXDIY9LKBMFx+WP1lYNCv+C37UXn58Zk+N6u//3X9/lchc9x1w+pXyHER+dr9hucs3uNcAPgUMbDzelV8/7uY/P++om8fUXzvpZyxWCRgqsoeNliWSRP/ntJCpuw4tEFhfzxc0V4uD0UqKX7IaxwCNcgjLn7Ck0qlr7gCoEjW2BnB4P8sQaE8CleI4nw3hBuhue73/XoX3sXqKJxyv08JGMnn0d27AFgYXK48YGmu6H43Vm6zz2YG26WMj4Zzy0myqKm5gvs4FyHxxj2JX/e/QIXb0vfN7f/MnfsqL1BQR0eL399/HhI45usUBh+/9bscCOIxyUJwl3Y3O0jS8dZ7nu63zS+L68vxPMSA48VH1c+j/z1AoBlqb6WOn9nQs5tc30qb1/L0YcbdXGKLRlufEFKAsnuGOnqUr4Iuj7L4Ubfjj+2Pa+d0ji547b7xWMSws3TdKzz18ePSW58Q8DptG3kViVGjRyrLzqGPf/BePZeH5yf0x9nue/566rmV2Gk80qvfxCPgXwe+esFAMtShZvwG1P3/dUUKzdjdiFCCg7uX9rCcQqhzPVZKPJi8V+gmBqFgroLIuk56YvtuPmFd8qx+uPlrp0cAOJrk46zfL5LXI98G2PjvXuP3Mb8MQaAaQg3JaP/mvfhQpzwS5YoQuVgY2XOv1Rk3LZMkGiPVTKrP6VgY+WCYGkM3TZ9uJGDhs60Y9nxNX21oS0e59znKe3rIcJN9ucheV1qI3xeCTcA1qcIN0+a6w/ma6lj/1XwNSiKRSjOg+LWTuSr/rZUKBRjbQjFcuTYuXAj27OYhrEbC4fJOedCQODOSxU4wsqQOgjFJhzL8KHG/LkC6T0uRPbGv1u5Go7zQcKNOO5S/+P9dp9Xwg2A+5CEG/dr372biQ+wYhMcPtyUluJ7egXIKYcDVZslIRSI4mP3C4sTBxtXKIf7dIrnuU8xTc9rIC78cZ+T8/JFNmPX53g/bZDLKRxXDDy7fssBMx4XEwbScT5MuDHS6ybvOxwXu4+9hoQbAOtTfi11GMcQbkJw2a9g9Pj2cisnAABgP4QbheSrgtn8v3r3WbUBAABFhBuVsBS/35K6C0ksywMAsCbCjZq7h2D210n+RtL9V38AAEAJ4QYAAFSFcAMAAKpCuAEAAFUh3AAAgKoQbgAAQFUINwAAoCqEGwAAUJUqw435Y3mLPS5hIe4P+O1U8/iFI3+cxN7P8bpn8jOjMM3Y87sA1K6ecGMeyucfVGgKhJvUzB/eO7I/nFfbs6UIN5OMnQ/hZgmEG+ChGwk3Z83NAZ8MPm3lJkxobbC5NPxTpMUnM4+LV1qcBYoO4eZeEW4U/DVMzis8ib17ffik74Fun12wyJrxM+l+Hgl9AHSK4eb8nQs22wg3gZ9cZ4aaIC1CYWLfc4Il3Nwrwo1CCDfRKqcLFJnztcFHsSqq3W8E4QbAFPlwc3rVvG9Dzc2FW73Z6srN3HtvpCLkCo9QyMO/cINSsNKEAVV76b+Qc33tilRxv7i9XEGS//U+J9yIhV4YH7ufGYOuCOePGa7RQLY49/ZJxtj1045VtO/kvkbnneid3y7cDMd5v2s2wvbvefN1e+zdcczx3WvbCTcTx2P0M2CMt2mvmR0jxTVLPgu5PsU/ZwQ7YIpMuHnSXH/42Ny9O2v/eyPhxkxUfnIyE6ErQGaCmDexSoXXFZ5he+lrflISJ8rWSLjRtvesDXCDfvmJOp5QpaKQvFc4htTXcO6DY4z0p0QaY6k914dhP6Tzk/uaHkM3xv41xXGnEPvc49p3x+3GQAwIymumYdtv+2jH3vXVtGWvc9gmvkdxLO1+I6RrWzRy3PCZGnxu2/cMP8e6Md5ds97r9vhR+7mfn+hnW9pvcv+BB04MNyfXt83d3Zvm3P7/razc7JiJIC7yUyVFyE84w8LkJr/kWKWJ1bcznESDGe11/L8wB+fnX4snz4ibnOOJM31vMiZGsT9l2vbcxB71P94vcx7pMbRj7Avbgv01xD73hEI5bD89Z+01U7F9N2259798av7Xj0W3TXrP2Geypd1vhPsMTCjupeMqr6F2jLXXTDsW8mck87kFIBLCTRxmthduluAm0yF16ChNnqVtc9rrkSbFrh/ZgpcviMP2MpPrHsVenMSF9jT7yYVIeK96jH24mRoURoh96ZH7EY+99prp2GOG95jxaYPND/3/X1m4yX1WhvRjrLtmLf8ZK49HLsTkzwdAKgk39ibiD1fNSffaAw433QTmC100gblJzbwuEwt+IQxMaq+bKCNCYYvbHU6coW8Z0RhsPdzox9iPy1GGG+0107HH7N7j2u7GIRcSNhxuxq6Box9j3TUbvr5rK3pf7uc6INwAKsNwc/Gmubu7ba5Pe68RbtxrdrKMJqs5E3cpDGjbCxNgNNGNT9r+X3+Dfmj/RZiZrEv9GSGer9CeZj9tuNFfM1+EjjLcLPuv+GG4ieTGSzuOc35GBHbcFgo3uc/KkH6Mp4WbHnuOcb8U7wMwahBu+r/6nXOfIeeowk0XDHoT0ZzCXnqPsj03maYT91jhdNJJe+77DFd0Jo6BJx3X9W3Ynnh+8VhJxczvM3iv+pqtE27GCqu2UOqumU6xrVxI0IYW7X4j3OcsP26J0nHttvHPgHaMZ4cbIznP6cHVjQ2BCOgTbygeYuWme91PikmRmTJ5jxRXVXvJeYTgFZ9zO8HGffDHH0yEIQSMTKhxqLL/39yfUehPidieOY+oPfFaJOMYhxFfXNrzi9+ru2ZxewsRPkN96kKpvGYa4vgGuc9rUpQztPuNcNdsoXDT/bxE29v3DPo56edi/JqZ/eJxFPs18hkZ8p9TI3cNgQeIcJMhT/hhUhxORv2i3Bm8tzcBJdIJe7y9dB8zaYrnHCboaN9ue0c+R3ky9uyk794ntzlu0J4997S9Ur8Gxx301RUuO07xe1vqa7Z0uGklx+4d120bL5T91wdttaZeC/mz7g3GWT6elXv/ouFG0hsr4bPeEc4vaVO81uNjPOWaJcccGffBvplxDG3qwhDwMCjCzeEcMtwAAIBtItwAAICqEG4AAEBVCDcAAKAqhBsAAFAVwg0AAKgK4QYAAFSFcAMAAKpCuAEAAFUh3AAAgKoQbgAAQFWqDDfmWSuTnrOy0PNvAADA4dUTbkxA8Q++Mw+y2z3obzy02AfPrfCARAAAcP/ScHPxprm7+yh405zH+65s2spNeGJ3G2wuDbMaowgt0tOlAQDAZmXCzW1zfRq9fgDzvpbyIUe5EmNWeW7ePm+eCdsAAMD2VBRu5JWb8r035muriffnAACAo1ZPuOndc2PuoVHdc8ONxAAAVEd5z839329jzPtaSv/bUtxIDABAfdJwk3jSXH8wAef+V3PmhhsVbiQGAKBKinDTOr1q3t99bN5fP5G3r2TNcGNvJH590jwWtgEAgO3ShZtPz5ob8/XUuzNh23rWCzfcSAwAQK104cbfh3NzIWxb0WrhhhuJAQCo1ni48V9J3feqjbFOuJn2d3AAAMC2JOHm5Pq291tSzn2v2ASrhBtuJAYAoGrKe24OY41ww43EAADU7YGFG24kBgCgdg9u5QYAANSNcAMAAKpCuAEAABX5pPk/M81VQsnUHbsAAAAASUVORK5CYII=" alt="x"></p> <p>最后我们还是回到了 <code>config.js</code>，我们去看 <code>genConfig</code>函数，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">genConfig</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> builds<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    input<span class="token operator">:</span> opts<span class="token punctuation">.</span>entry<span class="token punctuation">,</span>
    external<span class="token operator">:</span> opts<span class="token punctuation">.</span>external<span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        __WEEX__<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>opts<span class="token punctuation">.</span>weex<span class="token punctuation">,</span>
        __WEEX_VERSION__<span class="token operator">:</span> weexVersion<span class="token punctuation">,</span>
        __VERSION__<span class="token operator">:</span> version
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">flow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">buble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">alias</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>alias<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      file<span class="token operator">:</span> opts<span class="token punctuation">.</span>dest<span class="token punctuation">,</span>
      format<span class="token operator">:</span> opts<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
      banner<span class="token operator">:</span> opts<span class="token punctuation">.</span>banner<span class="token punctuation">,</span>
      name<span class="token operator">:</span> opts<span class="token punctuation">.</span>moduleName <span class="token operator">||</span> <span class="token string">'Vue'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">'process.env.NODE_ENV'</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>env<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token string">'_name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> name
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre></div><p><code>const opts = builds[name]</code> 我们拿到的是 build 这个对象中的每一个对象，然后我们在下面构建了一个新的对象。</p> <p>为什么我们要构建这个新的对象？</p> <p>因为我们构建的这个新对象是要给<code>Rollup</code>来使用的，也就是说 <code>entry</code> 是我们自己定义的他叫 entry，在 rollup 里面它叫<code>input</code>，所以要做一层转换。</p> <p>我们回到 <code>build.js</code> 文件，<code>let builds = require('./config').getAllBuilds()</code>我们最终拿到的是一个数组，数组中的每一个元素都经过了  <code>genConfig</code> 方法的处理，其实也就是生成了我们 rollup 所需要的配置对象，</p> <p>builds是一个数组，</p> <p>回到 <code>build.js</code> 中，我们会进行编译，因为要生成不同版本的 vue.js，<code>if (process.argv[2])</code>我们会根据传递的不同参数，这个参数对应的就是我们的 <code>npm scripts</code>，-- weex --web 这些，如果有这些参数呢我们会把不需要打包的给过滤掉，如果没有参数呢就把 weex 过滤掉，也就是打包 web 平台。</p> <p>最终我们得到的就是我们需要编译的，编译的话就是调用我们的 build 函数，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// filter builds via command line arg</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> filters <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> filters<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> b<span class="token punctuation">.</span>_name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// filter out weex builds by default</span>
  builds <span class="token operator">=</span> builds<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>output<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'weex'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">build</span><span class="token punctuation">(</span>builds<span class="token punctuation">)</span>
</code></pre></div><p>这个build方法也很简单，它里面有一个 <code>next</code>函数，<code>next</code> 函数执行的时候他会去调用 <code>buildEntry</code>方法，他还有一个计数器 <code>built</code>，这样他会一个一个去编译，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">build</span> <span class="token punctuation">(</span><span class="token parameter">builds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> built <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> builds<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">buildEntry</span><span class="token punctuation">(</span>builds<span class="token punctuation">[</span>built<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      built<span class="token operator">++</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>built <span class="token operator">&lt;</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>logError<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>buildEntry</code> 这个方法他是拿到了这个 <code>builds</code> 的配置，这个配置 就会作为 roolup 编译所需要的 config，配置编译完成我们就会拿到这个 <code>bundle</code>，这个 <code>bundle</code> 我们再调用这个 generate() 就产生这个 output，</p> <p>我们会对 code 做修改，会判断这个 js 需不需要去压缩，如果要压缩我们调用 <code>uglify</code> 进行压缩处理，最终写入到我们的 dist 文件目录，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">buildEntry</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> config<span class="token punctuation">.</span>output
  <span class="token keyword">const</span> <span class="token punctuation">{</span> file<span class="token punctuation">,</span> banner <span class="token punctuation">}</span> <span class="token operator">=</span> output
  <span class="token keyword">const</span> isProd <span class="token operator">=</span> <span class="token regex">/min\.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token keyword">return</span> rollup<span class="token punctuation">.</span><span class="token function">rollup</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">bundle</span> <span class="token operator">=&gt;</span> bundle<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> code <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> minified <span class="token operator">=</span> <span class="token punctuation">(</span>banner <span class="token operator">?</span> banner <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> uglify<span class="token punctuation">.</span><span class="token function">minify</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          output<span class="token operator">:</span> <span class="token punctuation">{</span>
            ascii_only<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          compress<span class="token operator">:</span> <span class="token punctuation">{</span>
            pure_funcs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'makeMap'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>code
        <span class="token keyword">return</span> <span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> minified<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们会在生成文件的过程中打印一些 log 信息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">write</span> <span class="token punctuation">(</span><span class="token parameter">dest<span class="token punctuation">,</span> code<span class="token punctuation">,</span> zip</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">report</span> <span class="token punctuation">(</span><span class="token parameter">extra</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">blue</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token function">getSize</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>extra <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>zip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        zlib<span class="token punctuation">.</span><span class="token function">gzip</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> zipped</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
          <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">' (gzipped: '</span> <span class="token operator">+</span> <span class="token function">getSize</span><span class="token punctuation">(</span>zipped<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="runtime-only-vs-runtime-compiler"><a href="#runtime-only-vs-runtime-compiler" class="header-anchor">#</a> Runtime Only VS Runtime + Compiler</h2> <p>通常我们利用 vue-cli 去初始化我们的 Vue.js 项目的时候会询问我们用的 Runtime Only 版本还是 Runtime + Compiler 版本。</p> <p>下面我们来对比这两个版本。</p> <ul><li>Runtime Only</li></ul> <p>我们在使用 Runtime Only 版本的 Vue.js 的时候，通常需要借助如 webpack 的 vue-loader 工具把 .vue 文件编译成 JavaScript，因为在浏览器端他是不认识 .vue 文件的，所以说他需要一个编译过程，那么在编译过程他会把我们写的 template 模板编译成 render 函数，所以我们最终编译出来的也是一个 render 函数的版本，所以我们用的 vue 是不带编译的版本，他是离线编译，这个编译是在离线时做的，所以它只包含运行时的 Vue.js 代码，因此代码体积也会更轻量。</p> <ul><li><p>Runtime + Compiler</p> <p>Runtime + Compiler 指的是你可以不对代码做预编译，</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 需要编译器的版本 (一定要使用 runtime + compiler 版本)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;{{ hi }}&lt;/div&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 这种情况不需要 compiler</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hi<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>runtime-only 就是只有运行时，编译是发生在 webpack 编译时候，通过 vue-loader 编译生成组件相关 JS 和 CSS，并把 template 部分转换成 render 函数添加到组件对象的属性中，
runtime-compiler 是在运行时编译，组件的模板直接在组件对象的 template 属性中编写，然后在运行时阶段编译生成 render 函数。</p></blockquote> <p>在这里你可能会问，第二种情况我们可以不使用 runtime + compiler 版本，但是我们的 .vue 文件里面不也写了 template 吗？</p> <p>那个是在编译过程中通过 <code>vue-loader</code>对 <code>.vue</code> 文件进行处理，所以我们写的 components 文件下的 .vue 文件实际上在他真正运行的时候已经编译成了 <code>javascript</code> 函数，并且他的模板部分已经编译成 <code>render</code> 函数了，</p> <p>因为在 Vue.js 2.0 中，最终渲染都是通过 <code>render</code> 函数，如果写 <code>template</code> 属性，则需要编译成 <code>render</code> 函数，那么这个编译过程会发生运行时，所以需要带有编译器的版本。</p> <p>很显然，这个编译过程对性能会有一定的损耗，所以通常我们更推荐使用 Runtime-Only 版本的 Vue.js。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-analysis-blog/chapter1/" class="prev router-link-active">
        Vue 源码目录设计
      </a></span> <span class="next"><a href="/vue-analysis-blog/chapter2/">
        从入口开始
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-analysis-blog/assets/js/app.6aeeb6df.js" defer></script><script src="/vue-analysis-blog/assets/js/2.8ac59259.js" defer></script><script src="/vue-analysis-blog/assets/js/5.b31e05fb.js" defer></script>
  </body>
</html>
